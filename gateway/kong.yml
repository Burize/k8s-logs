_format_version: "3.0"
services:
- name: protected_rest_api
  host: protected-service-api
  port: 3000
  protocol: http
  routes:
  - name: rest_api_route
    https_redirect_status_code: 426
    paths:
    - /
    preserve_host: false
    protocols:
    - http
    - https
    strip_path: true
consumers:
- username: authorized_user
jwt_secrets:
  - consumer: authorized_user
    secret: "secret_for_jwt"
plugins:
- name: jwt
  service: protected_rest_api
  enabled: true
  config:
    key_claim_name: iss
    claims_to_verify:
    - exp
- name: auth_plugin
  service: protected_rest_api
  enabled: true
  config:
    auth_service_url: 'http://auth-service-api:8083'
    auth_path: '/api/authenticate'
    services_exchange_header_name: 'X-SERVICE-EXCHANGE-KEY'
    services_exchange_key: 'SERVICE_EXCHANGE_SECRET_KEY'
    user_header_name: 'X-USER'
    jwt_credentials_url: 'http://0.0.0.0:8001/consumers/authorized_user/jwt'
- name: request-transformer
  service: protected_rest_api
  enabled: true
  config:
    rename:
      headers:
        - 'Authorization:X-USER'
    add:
      headers:
        - 'X-SERVICE-EXCHANGE-KEY:Bearer SERVICE_EXCHANGE_SECRET_KEY'
